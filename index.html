<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background: var(--tg-theme-bg-color, #1c1c1c);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .movie-card { width: 90%; max-width: 400px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-top: 20px; background: var(--tg-theme-secondary-bg-color); }
        .movie-card img { width: 100%; display: block; }
        .info { padding: 15px; }
        .buttons { display: flex; gap: 20px; margin-top: 20px; }
        button { padding: 15px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; }
        .like { background: #4caf50; color: white; }
        .dislike { background: #f44336; color: white; }
    </style>
</head>
<body>
    <div class="movie-card">
        <img id="poster" src="" alt="–ü–æ—Å—Ç–µ—Ä">
        <div class="info">
            <h2 id="title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        </div>
    </div>
    <div class="buttons">
        <button class="dislike" onclick="vote('dislike')">üëé</button>
        <button class="like" onclick="vote('like')">üëç</button>
    </div>

    <script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    const API_BASE = "https://larviparous-intercondylic-sherilyn.ngrok-free.dev";
    
    // –ü—ã—Ç–∞–µ–º—Å—è –¥–æ—Å—Ç–∞—Ç—å ID –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Å—ã–ª–∫–∏, –µ—Å–ª–∏ initData –ø—É—Å—Ç–æ–π
    const urlParams = new URLSearchParams(window.location.search);
    const userId = tg.initDataUnsafe.user?.id || urlParams.get('user_id') || 802527008;

    async function loadMovie() {
        console.log("–ó–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è ID:", userId);
        try {
            const response = await fetch(`${API_BASE}/get_movie/${userId}`, {
                headers: { 'ngrok-skip-browser-warning': 'true' }
            });
            const data = await response.json();

            if (data.title) {
                document.getElementById('title').innerText = data.title;
                document.getElementById('poster').src = "https://image.tmdb.org/t/p/w500" + data.poster;
            } else {
                document.getElementById('title').innerText = "–§–∏–ª—å–º–æ–≤ –Ω–µ—Ç";
            }
        } catch (e) {
            document.getElementById('title').innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: –ø—Ä–æ–≤–µ—Ä—å ngrok";
        }
    }

    function vote(type) {
        tg.HapticFeedback.impactOccurred('medium');
        loadMovie();
    }

    loadMovie();
</script>
</body>
</html>

