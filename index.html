<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            /* –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ—Ç TG –ø—É—Å—Ç–∞—è, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–µ–º–Ω—ã–π #1c1c1c */
            background: var(--tg-theme-bg-color, #1c1c1c);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .movie-card { width: 90%; max-width: 400px; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.2); margin-top: 20px; background: var(--tg-theme-secondary-bg-color); }
        .movie-card img { width: 100%; display: block; }
        .info { padding: 15px; }
        .buttons { display: flex; gap: 20px; margin-top: 20px; }
        button { padding: 15px 30px; border-radius: 50px; border: none; font-weight: bold; cursor: pointer; }
        .like { background: #4caf50; color: white; }
        .dislike { background: #f44336; color: white; }
    </style>
</head>
<body>
    <div class="movie-card">
        <img id="poster" src="" alt="–ü–æ—Å—Ç–µ—Ä">
        <div class="info">
            <h2 id="title">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        </div>
    </div>
    <div class="buttons">
        <button class="dislike" onclick="vote('dislike')">üëé</button>
        <button class="like" onclick="vote('like')">üëç</button>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        const API_BASE = "https://larviparous-intercondylic-sherilyn.ngrok-free.dev";
        const userId = tg.initDataUnsafe.user?.id || 802527008; // –ë–µ—Ä–µ–º ID –∏–∑ —Ç–µ–ª–µ–≥—Ä–∞–º –∏–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–π

        async function loadMovie() {
            try {
                const response = await fetch(`${API_BASE}/get_movie/${userId}`);
                const data = await response.json();
                document.getElementById('title').innerText = data.title;
                document.getElementById('poster').src = "https://image.tmdb.org/t/p/w500" + data.poster;
            } catch (e) {
                document.getElementById('title').innerText = "–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –∏–ª–∏ –æ—à–∏–±–∫–∞";
            }
        }

        function vote(type) {
            // –í –±—É–¥—É—â–µ–º –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API /api/vote
            // –ê –ø–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –≥—Ä—É–∑–∏–º —Å–ª–µ–¥—É—é—â–∏–π —Ñ–∏–ª—å–º –¥–ª—è —Ç–µ—Å—Ç–∞
            loadMovie();

            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ (–ø—Ä–∏—è—Ç–Ω–∞—è —Ñ–∏—à–∫–∞ Mini App)
            tg.HapticFeedback.impactOccurred('medium');
        }

        loadMovie();
    </script>
</body>
</html>
